---
title: "Sesión 1: LMM"
format:
  html:
    embed-resources: true
    toc: true
    number-sections: true
editor: visual
---

## Introducción

En esta sesión aprenderemos la intución que está detrás de los modelos LMM utilizando una base de datos que permita comprender de manera sencilla la importancia de esos modelos. Revisaremos temas descriptivos, la importancia de los grupos y ejecutaremos un modelo de regresión lineal simple.

Antes de ejecutar este documento, instala los paquetes necesarios. Copia y pega el siguiente código en la consola de R:

install.packages(c("readr", "dplyr", "summarytools", "lme4"))

## Cargar librerias y datos

En esta primera parte, cargaremos y exploraremos los datos que usaremos para la práctica. No necesitas escribir código: todos los comandos ya están listos para ejecutarse en R.

```{r, message=FALSE, warning=FALSE}


#Librerias
library(readr)
library(dplyr)
library(summarytools)
library(lme4)

# URL RAW del archivo en GitHub
url <- "https://raw.githubusercontent.com/edwinbhec5-glitch/sesion1_LMM/main/Base_de_estudiantes_por_escuela.csv"

# Descargar a un archivo temporal
temp_file <- tempfile(fileext = ".csv")
download.file(url, destfile = temp_file, mode = "wb")

# Leer con base
datos <- read_csv(temp_file)

#mostrar base
head(datos)

#mostrar no. grupos
table(datos$id_escuela)
```

# Estadísticos descriptivos

## General

```{r}
descr(datos[, c("horas_estudio", "nota")])
```

La variable nota, presenta una media de 66.6 con una desviación estándar de 12.7, indicando una dispersión moderada de los puntajes entre los estudiantes. Su distribución muestra una ligera asimetría positiva (skewness = 0.22). En cuanto a la variable explicativa horas de estudio, el promedio es de 4.05 horas, con una desviación estándar de 2.16, y una distribución también ligeramente asimétrica a la derecha (skewness = 0.67). Ambas variables presentan una cobertura completa de observaciones válidas (N = 300)

## Por grupos

```{r}

datos %>% 
  group_by(id_escuela) %>% 
  summarise(
    promedio_nota = mean(nota),
    sd_nota = sd(nota))
```

Al desagregar los datos por escuela, se observa una variabilidad considerable en las notas promedio entre instituciones. La escuela con el mayor promedio de nota alcanza los 76.9 puntos, mientras que la más baja registra 55.6 puntos, lo que refleja una diferencia de más de 20 puntos entre extremos. Además, la desviación estándar dentro de cada escuela también presenta variaciones, oscilando entre 8.3 y 13.2, lo que sugiere diferencias en la homogeneidad del rendimiento académico al interior de cada grupo escolar.

Estas diferencias sustentan la existencia de una agrupación natural en los datos que debe ser considerada en el análisis.

## Gráficos exploratorios

```{r}
# Boxplot de notas por escuela
boxplot(nota ~ id_escuela, data = datos,
        main = "Distribución de notas por escuela",
        xlab = "Escuela", ylab = "Nota")
```

El boxplot permite ver de manera más clara esas diferencias en la nota por escuela.

## Relación entre horas de estudio y nota

Para observar la relación entre la nota y un factor que puede influir en la misma, realizamos un gráfico de dispersión entre la nota y horas de estudio, e incorporamos una linea de tendencia

```{r}
plot(nota ~ horas_estudio, data = datos,
     main = "Nota vs Horas de estudio",
     xlab = "Horas de estudio", ylab = "Nota")
abline(lm(nota ~ horas_estudio, data = datos), col = "blue")
```

# Regresión lineal básica

Para determinar si las horas de estudio influyen sobre la nota, realizamos un Modelo de Regresión Lineal clásico

```{r}
modelo1 <- lm(nota ~ horas_estudio, data = datos)
summary(modelo1)
```

Los resultados del modelo muestran que la nota promedio de los estudiantes es de 58.9 y que las horas de estudio influyen de manera significativa sobre la nota.

## Conclusión

Hemos observado patrones simples en los datos y aplicado un modelo de regresión lineal básico. Pero no hemos considerado la influencia de los grupos sobre el resultado del modelo de regresión lineal básico. ¿Omitir esta información tendrá alguna implicación? ¿Qué tanto podría afectar?

En la siguiente sección, usaremos estos datos para ajustar nuestro primer modelo lineal mixto con la función lmer() del paquete lme4.
